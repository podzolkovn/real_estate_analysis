services:
  real-estate-analisis-app:
    restart: unless-stopped
    build: .
    environment:
      POSTGRES_HOST: ${DEV_POSTGRES_HOST}
      POSTGRES_PORT: ${DEV_POSTGRES_PORT}
      POSTGRES_DB: ${DEV_POSTGRES_DB}
      POSTGRES_USER: ${DEV_POSTGRES_USER}
      POSTGRES_PASSWORD: ${DEV_POSTGRES_PASSWORD}
      LOCALE_DIR: ${LOCALE_DIR}
      DEFAULT_LOCALE: ${DEFAULT_LOCALE}
    ports:
      - "8000:8000"
    entrypoint: ["./start.sh"]
    depends_on:
      real-estate-analisis-db:
        condition: service_healthy
    healthcheck:
      test: [ "CMD", "python3", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')" ]
      interval: 60s
      timeout: 3s
      retries: 3
    mem_limit: 512m

  real-estate-analisis-db:
    image: postgres:16
    restart: unless-stopped
    container_name:  real-estate-analisis-db
    environment:
      POSTGRES_DB: real-estate-analisis-db
      POSTGRES_USER: real-estate-analisis-user
      POSTGRES_PASSWORD: real-estate-analisis-pass
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U real-estate-analisis-user -d real-estate-analisis-db -h localhost" ]
      interval: 5s
      timeout: 5s
      retries: 5
    ports:
      - "5434:5432"
    mem_limit: 512m

volumes:

  real-estate-analisis-volume-db:
